<p id="notice"><%= notice %></p>
<% if current_user.id == @event.user.id %>
  <div align="right">
    <%= button_to "Delete", {controller: "events", action: "destroy", organization_id: @event.id}, method: :delete, class: ["btn", "btn-outline-danger btn-sm"] %>
  </div>
<% end %>
<h1><%= @event.name %></h1>
<div>
  <aside>
    Created by
    <%= @event.user.username %>
  </aside>
</div>
<% if @event.flyer.attached? %>
  <%= image_tag(@event.flyer, width: "400px", data: {target: "#myModal", toggle: "modal"}) %>
<% end %>
<div>
  <%= @event.location %>
</div>
<br>
<div>
  <%= @event.description %>
</div>
<br>
<br>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="myModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <% if @event.flyer.attached? %>
        <%= image_tag(@event.flyer, width: "800px") %>
      <% end %>
    </div>
  </div>
</div>

<% if @event.date == nil %>
  <p><strong>Possible Dates:</strong></p>
  <table class="table">
    <thead class="thead-light">
    <tr>
      <th scope="col">Date</th>
      <th scope="col">Votes</th>
    </tr>
    </thead>
    <tbody>
    <% @event.date_events.each do |date_event| %>
      <tr>
        <th scope="row"><%= date_event.date %></th>
        <th scope="row"><%= date_event.votes.count %></th>
      </tr>
    <% end %>
    </tbody>
  </table>

  <div class="modal fade" id="modalLoginForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div role="document">
          <div align="center">
            <br>
            <%= render partial: "date_events/form",
                       locals: {
                           event_id: @event.id,
                       } %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <% if user_signed_in? %>
    <% if @event.user_id == current_user.id %>
      <div class="text-right">
        <a href="" class="btn btn-success btn-rounded mb-4" data-toggle="modal" data-target="#modalLoginForm">Add
          Date</a>
      </div>
    <% else %>
      <div class="modal fade" id="modalVoteForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div role="document">
              <div align="center">
                <br>
                <%= render partial: "votes/form",
                           locals: {
                               event_id: @event.id,
                           } %>
              </div>
            </div>
          </div>
        </div>
      </div>
      <% if true%>
        <div class="text-right">
          <a href="" class="btn btn-success btn-rounded mb-4" data-toggle="modal" data-target="#modalVoteForm">Vote for
            Date</a>
        </div>
      <% end %>
    <% end %>
  <% end %>

<% else %>
  <div class="text-center">
    <p><strong><%= @event.date %></strong></p>
  </div>
<% end %>


<p><strong>Guests</strong></p>
<table class="table">
  <thead class="thead-light">
  <tr>
    <th scope="col">Username</th>
    <th scope="col">Role</th>
  </tr>
  </thead>
  <tbody>
  <% @event.users.each do |user| %>
    <tr>
      <th scope="row"><%= link_to user.username, user_path(user.id) %></th>
      <% if @event.user == user %>
        <th scope="row">
          <p style="color:#21bf40">Owner</p>
        </th>
      <% else %>
        <th scope="row"> Guest</th>
      <% end %>
    </tr>
  <% end %>
  </tbody>
</table>
<br>

<div class="modal fade" id="modalGuestForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div role="document">
        <div align="center">
          <br>
          <%= render partial: "user_guests/form",
                     locals: {
                         event_id: @event.id,
                     } %>
        </div>
      </div>
    </div>
  </div>
</div>
<% if user_signed_in? %>
  <% if @event.user_id == current_user.id %>
    <div class="text-right">
      <a href="" class="btn btn-success btn-rounded mb-4" data-toggle="modal" data-target="#modalGuestForm">Invite
        friend</a>
    </div>
  <% end %>
<% end %>
<p><strong>Comments:</strong></p>
<% if user_signed_in? %>
  <div>
    <%= render partial: "comments/form",
               locals: {
                   event_id: @event.id,
               } %>
  </div>
<% end %>
<table class="table">
  <thead class="thead-light">
  <tr>
  </tr>
  </thead>
  <tbody>
  <% @comments.each do |comment| %>
    <tr>
      <td>  <%= link_to comment.user.username, user_path(comment.user.id) %>:
        <br> <%= comment.text %>
      </td>
      <td align="right">
        <% if comment.user.username == current_user.username %>
          <%= button_to "Delete", {controller: "comments", action: "destroy", id: comment.id}, method: :delete, class: ["btn", "btn-outline-danger btn-sm"] %>
        <% end %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>
<br>
<div align="right">
  <%= link_to "Back", events_path, class: ["btn", "btn-outline-dark"] %>
</div>
